pipeline {
  agent none
  stages {
    stage('Fetch source') {
      agent { label 'build'}
      steps {
        checkout([$class: 'GitSCM', branches: [[name: '*/master']], 
            extensions: [[$class: 'RelativeTargetDirectory', 
            relativeTargetDir: 'utilsrc']], userRemoteConfigs: [[credentialsId: 'github-certificate', url: 'https://github.com/miniclub/IRISUtils']]])
      }
    }
    stage('Build KIT') {
      agent { label 'build'}
      steps {
        // キットの作成
        bat 'loader -U "%%SYS" loader\\buildkit.xml utilsrc\\src IRISUtils'
      }
    }
    stage('Archive artifacts') {
      agent { label 'build'}
      steps {
        dir('kit') {
          archiveArtifacts artifacts: '*.xml'
        }
      }
    }
  }
}
