pipeline {
  agent { label 'build'}
  stages {
    stage('Fetch source') {
      steps {
        checkout([$class: 'GitSCM', branches: [[name: '*/master']], 
            extensions: [[$class: 'RelativeTargetDirectory', 
            relativeTargetDir: 'utilsrc']], userRemoteConfigs: [[credentialsId: 'github-certificate', url: 'https://github.com/miniclub/IRISUtils']]])
            //relativeTargetDir: 'utilsrc']], userRemoteConfigs: [[ url: 'https://github.com/miniclub/IRISUtils']]])
      }
    }
    stage('Build KIT') {
      steps {
        // キットの作成
        bat 'c:\\InterSystems\\IRIS\\bin\\loader -U "%%SYS" loader\\buildkit.xml src\\Test IRISUtils'
      }
    }
    stage('Archive artifacts') {
      steps {
        dir('kit') {
          archiveArtifacts artifacts: '*.xml'
        }
      }
    }
  }
}
